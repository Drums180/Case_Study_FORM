---
title: "Form-Deliverable2"
author: "David Dominguez - A01570975, Alejandra Suárez - A00835247, Daniel Nájera - A01709578, Eduardo Camacho - A01026437, Gabriel Medina - A01275763"
date: "2024-03-13"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_download: TRUE
    theme: cosmo
---

![FORM BANNER](/Users/daviddrums180/Tec/Case_Study_Form/src/form.jpg)

CD2001C -- Analítica para Negocios: De Los Datos a las Decisiones Febrero -- Junio 2024

# Entregable 2 -- Evidencia 1

## Situación Problema 1: Rotación de Personal

Explorar, definir, y describir cuáles son los principales factores del clima organizacional de FORM que propician la satisfacción y/o no satisfacción de trabajar en dicha empresa.

La rotación de personal se ha identificado como el desafío más crítico que enfrenta FORM en el presente. A pesar de nuestros esfuerzos continuos para crear un ambiente laboral atractivo y retener a nuestros valiosos empleados, nos encontramos con una tasa de rotación especialmente alta entre los operadores. Este fenómeno no solo afecta la continuidad y la eficiencia de nuestras operaciones, sino que también incrementa los costos asociados con el reclutamiento y la capacitación de nuevo personal.

-   **Principales Puntos:**
    -   La estabilidad familiar y las condiciones laborales son factores significativos que influyen en la decisión de los empleados de permanecer en la empresa.
    -   Los jóvenes, especialmente aquellos sin compromisos familiares, tienden a buscar oportunidades de desarrollo profesional fuera de FORM.
    -   Es crucial mejorar nuestras estrategias de reclutamiento y retención para abordar las causas subyacentes de la rotación de personal.

## Situación Problema 2: Predicción de Demanda

Explorar, desarrollar, y describir la(s) posible(s) estrategia(s) de predicción de la demanada de productos fabricados por la empresa FORM.

La predicción precisa de la demanda representa un desafío igualmente significativo para FORM, dada la variabilidad inherente en la producción y venta de autopartes. La habilidad para anticipar con exactitud cuántas unidades de un determinado componente serán necesarias es crucial para optimizar nuestros procesos de producción y empaque, y para asegurar que se maximice la eficiencia en el uso de recursos.

-   **Principales Puntos:**
    -   La naturaleza fluctuante de la demanda automotriz complica la planificación y gestión de inventarios.
    -   Es esencial desarrollar herramientas y procesos más sofisticados para mejorar la precisión en nuestras predicciones de demanda.
    -   La adaptabilidad y la capacidad de responder rápidamente a los cambios en el mercado son fundamentales para mantener nuestra competitividad.

## Análisis Descriptivo de los Datos

A partir de las diferentes bases de datos compartidas por la empresa FORM y las industrias relacionadas con dicha empresa, seleccionar al menos 1 situación problema y elaborar lo siguiente:

## Librerías necesarias

```{r message=FALSE, warning=FALSE}
library(imputeTS)
library(xts)
library(zoo)
library(tseries)
library(stats)
library(forecast)
library(astsa)
library(corrplot)
library(AER)
library(vars)
library(dynlm)
library(vars)
library(mFilter)
library(tseries)
library(TSstudio)
library(forecast)
library(tidyverse)
library(sarima)
library(vars)
library(readr)
library(readxl)
library(heatmaply)
```

### Preguntas de Análisis

Elaborar 4-6 preguntas relacionadas con la situación problema seleccionada que se puedan responder mediante el análisis de datos.

Preguntas RRHH

¿Qué está causando la rotación de personal tan alta?
¿Existe algún momento del año donde se den más bajas dentro de la empresa?
¿Cómo se siente la gente dentro de su trabajo actual?
¿Qué factor ayuda a que el personal dure más tiempo dentro de la empresa?
¿En qué parte de la empresa el trabajador se siente más inconforme y cuál es su perfil?

## Pronosticos y Nearshoring

¿Cómo es el posible impacto del Nearshoring sobre la Empresa FORM?

-   Mediante el uso de visualización de datos describir el posible impacto del fenómeno nearshoring sobre el desempeño de la empresa FORM.

-   Pronosticar el evento de Nearshoring.

### Pronosticar el desempeño de FORM

#### Bases de Datos de Ventas
```{r message=FALSE, warning=FALSE}
#file.choose()
setwd("../databases/")
ventas1 <- read_excel("form/FORM-Ventas.xlsx")
ventas2 <- read_excel("form/FORM-Ventas.xlsx")

# data de bases
names(ventas1)
str(ventas1)
```

**Analisis de Numero de Data Faltante**
```{r}
# Calcula y muestra la cantidad de valores NA por columna en ventas1.
na_count1 <- colSums(is.na(ventas1))
na_count1

# Elimina columnas con NA en ventas1 y las últimas 3 filas.
ventas1 <- ventas1[, colSums(is.na(ventas1)) == 0]
ventas1 <- head(ventas1, -3)

# Calcula y muestra la cantidad de valores NA por columna en ventas2.
na_count2 <- colSums(is.na(ventas2))
na_count2

# Elimina filas con NA en ventas2.
ventas2 <- ventas2[complete.cases(ventas2), ]

# Renombra la columna "Ventas Totales" a "Ventas_totales" en ventas1.
names(ventas1)[names(ventas1) == "Ventas Totales"] <- "Ventas_totales"
```

Observamos una presencia significativa de valores NA. Por ello, decidimos eliminar las columnas que contengan valores NA en la base de datos 1 y las filas con valores NA en la base de datos 2.

```{r}
#ventas1$Mes <- as.yearmon(paste(ventas1$Año, ventas1$Mes), "%Y %B")
#ventas2$Mes <- as.yearmon(paste(ventas2$Año, ventas2$Mes), "%Y %B")
```

#### Pruebas de Diagnostico en la Data

```{r}
ventas1$Mes <- as.Date(paste(ventas1$Año, ventas1$Mes), format = "%Y %B")

Ventas <- ts(ventas1$Ventas_totales, start = c(2017, 1), end=c(2022,9), frequency = 12)

print(Ventas)
```

La variable dependiente se define como "Ventas Totales", correspondiente a las ventas totales realizadas por FORM.

```{r}
ts_plot(Ventas)
```

Entre 2018 y 2020, la serie de tiempo muestra una tendencia lineal. Sin embargo, después de 2020, emerge un patrón estacional claro, y aunque puede presentar cierta estacionariedad, se observa una tendencia ascendente general a lo largo de todo el periodo analizado.

```{r}
Ventasdesc<-decompose(Ventas)
plot(Ventasdesc)
```

La tendencia, que representa el componente a largo plazo de la serie de tiempo, indica un aumento constante en las ventas totales de FORM a lo largo del periodo observado. 

La estacionalidad, por otro lado, refleja las variaciones a corto plazo, revelando que las ventas de FORM tienden a incrementarse en determinadas épocas del año, como el último trimestre, y disminuir en otras, como el primer trimestre, lo cual podría estar relacionado con el aumento progresivo en la demanda de los clientes a medida que avanza el año, seguido de una caída hacia el final. 

La aleatoriedad, el componente impredecible de la serie de tiempo, indica fluctuaciones en los datos que no se explican por la tendencia ni por la estacionalidad, sugiriendo incrementos inesperados en la demanda por parte de los clientes.

```{r}
adf.test(ventas1$Ventas_totales)
```

Dado que el valor p de 0.284 supera el umbral de significancia comúnmente aceptado de 0.05, no contamos con suficiente evidencia para descartar la hipótesis nula, que asume la no estacionariedad de la serie de tiempo. Por ende, de acuerdo con este análisis, la serie temporal se considera no estacionaria.

```{r}
acf(ventas1$Ventas_totales)
```

El gráfico indica que la Función de Autocorrelación (ACF) es positiva para los rezagos 1, 2 y 3, lo que sugiere una correlación positiva entre los valores de la serie temporal en estos intervalos. Esto implica que los valores de la serie tienden a moverse en la misma dirección en estos periodos.

Por otro lado, la ACF es negativa para los rezagos 4, 5 y 6, señalando una correlación negativa en estos puntos. Esto significa que los valores de la serie temporal tienden a moverse en direcciones opuestas durante estos intervalos.

Estas características sugieren que la serie temporal podría exhibir un comportamiento estacional, donde la correlación positiva a corto plazo indica patrones de movimiento conjunto debido a tendencias estacionales, como períodos de alta o baja demanda durante ciertas épocas del año. La correlación negativa a más largo plazo podría indicar una tendencia de los valores de la serie a retornar hacia un promedio a lo largo del tiempo, reflejando una reversión a la media estacional.

#### Modelo Arma Calculado

```{r message=FALSE, warning=FALSE}
summary(ARMA<-arma(diff(Ventas)),order=c(1,1))
```

```{r}
plot(ARMA)
```

El término AR(1) es significativo (p-value = 0.0146), lo que indica que es importante en el modelo. Sin embargo, el término MA(1) no es significativo (p-value = 0.8199).
Los residuos del modelo tienen una varianza estimada (sigma^2) de 1.882e+12 y los resultados del ajuste muestran un AIC de 2120.88. Además, se ha incluido un término de interceptación con un valor estimado de 1.386e+05

#### Modelo Arima Calculado

```{r}
summary(ARIMA<-Arima(diff(log((Ventas))),order=c(1,1,1))) 
```

```{r}
plot(ARIMA)
```

Los coeficientes estimados para el término AR(1) y el término MA(1) son -0.4977 y -1.0000 respectivamente. Esto indica que hay una relación negativa entre el valor actual y los valores rezagados.

Los errores estándar de los coeficientes (s.e.) son 0.1040 y 0.0422 para el término AR(1) y el término MA(1) respectivamente.

La varianza estimada de los errores del modelo (sigma^2) es de aproximadamente 0.05168.

El logaritmo de la verosimilitud es de aproximadamente 2.55 y el AIC es de 0.91. Estas medidas proporcionan información sobre la calidad del ajuste del modelo, con valores más bajos indicando un mejor ajuste.

La serie de tiempo de las ventas no es estacionaria, lo que significa que la media y la varianza de la serie de tiempo están cambiando con el tiempo.

#### Evaluación de Modelos

**ARMA**
```{r}
arma_residuals<-ARMA$residuals
Box.test(arma_residuals,lag=1,type="Ljung-Box")
```

Esto significa que no se encontró evidencia significativa de autocorrelación en los residuos.

```{r}
suppressWarnings({
ARMA$residuals <- na.omit(ARMA$residuals)
adf.test(ARMA$residuals)
})
```

Dado que el valor p (0.09034) es mayor que el nivel de significancia comúnmente utilizado de 0.05, no podemos afirmar con confianza que los residuos sean estacionarios según esta prueba. 

```{r}
hist(ARIMA$residuals)
```

La normalidad se ve en los residuales.

**ARIMA**

```{r}
arima_residuals<-ARIMA$residuals
Box.test(arima_residuals,lag=1,type="Ljung-Box")
```

Esto significa que no se encontró evidencia significativa de autocorrelación en los residuos.

```{r}
suppressWarnings({
ARIMA$residuals <- na.omit(ARIMA$residuals)
adf.test(ARIMA$residuals)
})
```

Dado que el valor p (0.03156) es menor que el nivel de significancia comúnmente utilizado de 0.05, los residuos parecen ser estacionarios según esta prueba. 

```{r}
hist(ARIMA$residuals)
```

La normalidad se ve en los residuales.

#### Selección de Modelo

Se selecciono el modelo ARIMA, ya que tiene el AIC mas bajo en comparación con el modelo ARMA.

#### Forecast de Ventas de FORM

```{r}
suppressWarnings({
  # Asigna las predicciones ajustadas por el modelo ARIMA a la variable.
  arima_restauracion <- (ARIMA$fitted)
  
  # Convierte las predicciones ajustadas en un vector.
  vector2 <- c(arima_restauracion)
  
  # Convierte los datos originales de ventas en un vector.
  original2 <- c(Ventas)
  
  # Realiza la operación inversa a la diferencia, sumando los valores originales a las diferencias.
  restauracion2 <- vector2 + original2
  
  # Convierte el vector restaurado en una serie temporal, especificando inicio, fin y frecuencia.
  ts2 <- ts(restauracion2, start = 1, end = length(restauracion2), frequency = 12)
})
```


```{r}
arima_forecast<-forecast(ts2,h=5)
arima_forecast
```

```{r}
plot(arima_forecast)
```

```{r}
autoplot(arima_forecast)
```

**Forecast Calculado**

Los pronósticos para los próximos periodos se presentan a continuación, reflejando las expectativas de ventas futuras basadas en el análisis realizado:

- **Periodo 1:** 5,842,742
- **Periodo 2:** 6,439,323
- **Periodo 3:** 5,807,800
- **Periodo 4:** 5,986,388
- **Periodo 5:** 6,553,629

Cada valor representa la proyección de ventas para el periodo correspondiente, indicando fluctuaciones en la demanda o en las tendencias de ventas identificadas por el modelo. Estos pronósticos son cruciales para la planificación estratégica y la toma de decisiones en el ámbito empresarial.

#### Modelo Var Calculado

Del conjunto de datos, se seleccionaron las variables explicativas que podrían explicar las ventas de FORM.

```{r message=FALSE, warning=FALSE}
setwd("../databases/")
ventas2 <- read_excel("form/FORM-Ventas.xlsx")

names(ventas2)[names(ventas2) == "Ventas Totales"] <- "Ventas_totales"
names(ventas2)[names(ventas2) == "Total Carton"] <- "Total_carton"
names(ventas2)[names(ventas2) == "Total Retornable"] <- "Total_retornable"
names(ventas2)[names(ventas2) == "Variación"] <- "Variacion"
```

#### Impacto de Variables sobre Ventas

```{r}
Sys.setlocale("LC_TIME", "es_ES.UTF-8")
ventas2 <- na.omit(ventas2[, c("Año", "Mes", "Ventas_totales", "Total_carton", "Total_retornable", "Variacion", "Servicios", "Muestras")])
ventas2$Fecha <- as.Date(paste(ventas2$Año, ventas2$Mes, "01"), format = "%Y %B %d")
Ventas2 <- ts(ventas2$Ventas_totales, start = c(as.numeric(format(min(ventas2$Fecha), "%Y")), as.numeric(format(min(ventas2$Fecha), "%m"))), frequency = 12)
plot(Ventas2)
```

```{r}
Carton <- ts(ventas2$Total_carton, start = c(year(min(ventas2$Fecha)), month(min(ventas2$Fecha))), frequency = 12)

ts_plot(Carton)
```


```{r}
Retornable <- ts(ventas2$Total_retornable, start = c(year(min(ventas2$Fecha)), month(min(ventas2$Fecha))), frequency = 12)
ts_plot(Retornable)
```


```{r}
servicio <- ts(ventas2$Servicios, start = c(year(min(ventas2$Fecha)), month(min(ventas2$Fecha))), frequency = 12)
ts_plot(servicio)
```


```{r}
muestra <- ts(ventas2$Muestras, start = c(year(min(ventas2$Fecha)), month(min(ventas2$Fecha))), frequency = 12)
ts_plot(muestra)
```


```{r}
variacion <- ts(ventas2$Variacion, start = c(year(min(ventas2$Fecha)), month(min(ventas2$Fecha))), frequency = 12)
ts_plot(variacion)
```

Total cartón: al igual que la variable dependiente, muestra una tendencia de crecimiento, esto puede significar que estan altamente relacionadas.

Total retornable: al igual que la variable dependiente, muestra una tendencia de crecimiento, esto puede significar que estan altamente relacionadas.

Serivicos: La serie temporal no muestra una relación clara entre los servicios y las ventas, esto puede ser debido a la demanda del mercado. 

#### Tests de Diagnostico

```{r}
adf.test(Carton) 
```

Dado que el valor p (0.9594) es mucho mayor que el nivel de significancia comúnmente utilizado de 0.05, o podemos afirmar con confianza que la serie "Carton" sea estacionaria según esta prueba.

```{r}
adf.test(Retornable) 
```

Dado que el valor p (0.8272) es mucho mayor que el nivel de significancia comúnmente utilizado de 0.05, o podemos afirmar con confianza que la serie "Carton" sea estacionaria según esta prueba.

#### Evaluación de Modelos Var

```{r message=FALSE, warning=FALSE}
var_ts<-cbind(diff(log(Ventas2)), diff(log(Carton)), diff(log(Retornable)))
colnames(var_ts)<-cbind("Ventas_2", "Carton", "Retornable") 
acf_var_ts <- lapply(var_ts, acf)
head(var_ts)
```

```{r}
var_ts <- ts(var_ts, frequency = 1, start = c(2022))

# Realiza la selección de rezagos
lag_selection <- VARselect(var_ts,lag.max=3,type="const", season=12)

# Imprime los resultados
lag_selection$selection
```

```{r}
lag_selection$criteria
var_ts
```

#### Restricciones de Modelo Var

```{r}
var_modelo<-VAR(var_ts,p=1) 
#summary(VAR_ev2model1)
matriz_correlacion <- cor(var_ts)
# Imprimir la matriz de correlación
print(matriz_correlacion)
```

No es posible aplicar el modelo VAR debido a la alta correlación entre las variables explicativas y la variable dependiente. Este fenómeno podría explicarse por el hecho de que el **total de cartón** y el **total de retornable** constituyen conjuntamente el **total de ventas**. La matriz de correlación revela lo siguiente:

- La correlación entre `Ventas_2` y `Carton` es aproximadamente **0.5037**. Esto sugiere una correlación positiva moderada entre estas dos variables.
- La correlación entre `Ventas_2` y `Retornable` es aproximadamente **0.3336**. Esto también indica una correlación positiva, pero más débil en comparación con la correlación entre `Ventas_2` y `Carton`.

```{r message=FALSE, warning=FALSE}
modelo <- lm(Ventas_totales ~ Total_carton + Total_retornable + servicio + muestra + variacion, data = ventas2)
durbinWatsonTest(modelo)
```

Según el test de Durbin-Watson, no hay evidencia de autocorrelación de primer orden en los residuos del modelo de regresión lineal.

```{r message=FALSE, warning=FALSE}
var_residuals<-data.frame(residuals(var_modelo))

forecast_2<-predict(var_modelo,n.ahead=5,ci=0.95) ### forecast for the next 12 months
fanchart(forecast_2,names="Ventas",main="Ventas",xlab="Time Period",ylab="Ventas")
```

```{r}
forecast_2
```

```{r message=FALSE, warning=FALSE}
forecast_2$fcst$Ventas_2 <- exp(forecast_2$fcst$Ventas_2)  


forecast_2$fcst$Ventas_2[1] = forecast_2$fcst$Ventas_2[1] + tail(ventas2$Ventas_totales, 1)
forecast_2$fcst$Ventas_2[2] = forecast_2$fcst$Ventas_2[2] + tail(ventas2$Ventas_totales, 1)
forecast_2$fcst$Ventas_2[3] = forecast_2$fcst$Ventas_2[3] + tail(ventas2$Ventas_totales, 2)
forecast_2$fcst$Ventas_2[4] = forecast_2$fcst$Ventas_2[4] + tail(ventas2$Ventas_totales, 3)
forecast_2$fcst$Ventas_2[5] = forecast_2$fcst$Ventas_2[5] + tail(ventas2$Ventas_totales, 4)
```

```{r}
forecast_2$fcst$Ventas_2
```

#### Forecast de Ventas para Modelo VAR

Presentamos a continuación las proyecciones de ventas utilizando el modelo VAR para los próximos cinco periodos. Estas estimaciones nos permiten anticipar la dinámica del mercado y ajustar nuestras estrategias operativas y financieras acorde a las expectativas futuras:

- **Periodo 1:** Se espera que las ventas alcancen los 11,577,529, manteniendo una línea con los resultados anteriores.
- **Periodo 2:** Las ventas se proyectan estables, sin variación respecto al periodo anterior, en 11,577,529.
- **Periodo 3:** Se anticipa una leve disminución en las ventas, situándose en 11,053,018, lo que podría reflejar ajustes estacionales o de mercado.
- **Periodo 4:** Se prevé una reducción más notable en las ventas, descendiendo a 9,495,208. Este periodo requerirá atención para mitigar los impactos negativos.
- **Periodo 5:** Las ventas podrían disminuir hasta los 8,623,445, indicando la importancia de desarrollar estrategias de recuperación y adaptación.

Estas proyecciones son una herramienta vital para la planificación estratégica, permitiéndonos preparar con anticipación para los cambios en el entorno de ventas.

#### Insights de Ambos Modelos

Los pronósticos para las ventas en los próximos cinco períodos revelan tendencias y desafíos importantes para el futuro próximo. Al inicio, se espera que las ventas se mantengan estables, alcanzando una cifra proyectada de alrededor de 11,577,529 en el primer período. Esta estabilidad sugiere una fase de mercado sin grandes cambios, ofreciendo una oportunidad para consolidar estrategias actuales.

Para el segundo período, las proyecciones indican una continuidad en esta tendencia, con ventas esperadas similares a las del primer período. Esta persistencia subraya una etapa de estabilidad, posiblemente debido a la efectividad de las estrategias de mercado actuales o a un equilibrio en la dinámica de demanda y oferta.

No obstante, el escenario se modifica ligeramente en el tercer período, donde se prevé un descenso en las ventas hasta 11,053,018. Este ligero retroceso podría ser un indicativo de una disminución en la demanda o de la influencia de factores externos que afectan negativamente el volumen de ventas.

El cuarto período presenta retos más significativos, con una proyección de ventas que disminuye considerablemente a 9,495,208. Este notable declive señala la necesidad de revisar críticamente las estrategias de mercado y, posiblemente, adaptarse a un entorno competitivo más agresivo o a cambios en las preferencias de los consumidores.

Finalmente, el quinto período continúa con esta tendencia de decrecimiento, evidenciando una reducción adicional en las ventas. Este patrón sugiere un aumento en la competencia o una significativa disminución en la demanda, destacando la importancia de una estrategia empresarial flexible y proactiva para superar estos desafíos y fomentar un crecimiento renovado.

Estos pronósticos no solo proporcionan una visión de los posibles escenarios futuros, sino que también enfatizan la necesidad de adaptabilidad y proactividad en la planificación estratégica para mantener la relevancia y competitividad en un mercado dinámico.

## Diseño, Organización, y Limpieza de Base de Datos

-   Seleccionar información y datos que consideren relevantes para responder las preguntas de análisis.

-   Diseñar y organizar base(s) de datos a partir de la información y datos seleccionados.

-   Visualizar en R los primeros 6 renglones de la nueva base de datos.

-   Elaborar glosario de las variables que se incluyen en la nueva base de datos.

## Análisis Exploratorio de los Datos (EDA)

-   Desarrollar EDA que responda cada una de las preguntas de análisis.

-   Considerar los siguientes elementos en el desarrollo de EDA para responder las preguntas de análsis:

-   **a. Estadísticos Descriptivos**

-   **b. Medidas de Dispersión**

-   **c. 4-6 Gráficos (barras, líneas, pastel, dispersión, burbujas, correlación, mapas)**

-   **d. Tablas (frequencia, contingencia)**

-   **e. Pronóstico de ventas (e.g., unidades de producción, ventas en \$)**

-   **Interpretación** Interpretar los hallazgos identificados en el desarrollo de EDA para responder las preguntas de análisis.

## Búsqueda de información y datos

-   ¿Qué tipo de información / datos solicitarías al socio formador para mejorar EDA? 

Para poder tener un Análisis Exploratorio de los Datos completo, debemos de desarrollar soluciones efectivas a los problemas de la empresa, principalmente en la rotación de personal y la predicción de la demanda en producción es por eso que pediríamos información como:

1.  Información detallada sobre las bases de datos, como base de datos completa de personal. También, en la base de datos de ventas incluir más información, ya que cuenta con NA, lo que hace complicaciones en el análisis, que no podamos trabajar con muy pocos datos y eso limita nuestro trabajo para poder seguir identificando hallazgos importantes para la empresa

2.  Data de encuestas de bajas, sobre todo incluyendo las razones de la renuncia para poder detectar diferentes tendencias y patrones.

3.  Un Análisis Demográfico para saber datos de la edad, género, situación familiar y ubicación geográfica de los empleados para poder relacionar patrones con la rotación que existe en FORM.

De forma más simple, los datos explicitos más necesarios son: 
-⁠ **⁠BASE DATOS COMPLETA DE PERSONAL**
-⁠ **⁠DATA DE ENCUESTAS DE RAZON DE BAJAS**
-⁠ **⁠DATA DE TIEMPOS DE INVENTARIO**
-⁠ **⁠DATA DE DESGLOSE DE VENTA DE UNIDADES POR CLIENTE / O POR TIPO DE PARTE**

-   ¿Qué tipo de información / datos de fuentes secundarias buscarías para mejorar EDA?

Para complementar el EDA, con información de fuentes externas, buscamos información en:

1.  Informes de la Industria (Statista) debido a que nos proporciona estadísticas globales sobre la industria automotriz. incluyendo las tendencias tecnológicas.

2.  Estudios sobre el mercado de los empaques (Smithers) publican análisis de tendencias e informes de mercado de los empaques que se utilizan en el sector automotriz.

3.  Datos de Comercio Internacional y económicos (Banco Mundial) para los datos de tarifas y economía global que afectan el comercio de los empaques

4.  (Hoovers) para un Análisis de Competencia, donde se ofrecen datos importantes sobre las empresas y un análisis detallado de competidores en la industria de empaques.

-   (Opcional) Buscar información / datos de fuentes secundarias (por ejemplo, INEGI, Industria Nacional de Autopartes, etc.) que contribuyan a mejorar EDA y la identificación de hallazgos releventes que respondan las preguntas de análisis. Citar las fuentes secundarias seleccionadas.

Para tener un análisis más detallado buscamos información en diferentes fuentes:

**1.**  Crecimiento del Sector Automotriz, en el 2024 se espera que la cifra de vehículos comercializados en México incremente en un 8% y esto representa 100 mil unidades más que en el 2023. En 2023 tuvo un crecimiento del 24.4% en vehículos comercializados comparado con el 2022. (Mexico Industry, 2024). Estos datos son un potencial aumento de demanda en los empaques de autopartes lo que es un impacto positivo para FORM.

**2.**  Impacto en la electromovilidad, ya que existe una transición hacia la electromovilidad y esto genera una oportunidad para la creación de empleos y la demanda de competencias especializadas, esto impacta e influye de manera significativa a la demanda de empaques para los autopartes y componentes electrónicos y sistemas avanzados en los automóviles.


#Librerías
```{r message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
library(psych)
library(tidyr)
library(readtext)
library(syuzhet)
library(RColorBrewer)
library(wordcloud)
library(tm)
```


## Importando base de datos
```{r}
datos <- read_excel("C:\\Users\\suare\\Downloads\\Encuesta_Datos_FORM_Fall2023.xlsx")
```

# **Análisis Exploratorio de los Datos**
```{r message=FALSE, warning=FALSE}
datos_num <- datos
datos_num[sapply(datos_num, is.factor)] <- lapply(datos_num[sapply(datos_num, is.factor)], as.numeric)
```

## Estructura de la base de datos
```{r message=FALSE, warning=FALSE}
str(datos_num)
```

## Medidas Descriptivas
```{r message=FALSE, warning=FALSE}
summary(datos_num)
```

```{r message=FALSE, warning=FALSE}
describe(datos_num)
```

# Medidas de Dispersión

## Cálculo de medidas de dispersión para cada variable numérica relevante
```{r message=FALSE, warning=FALSE}
sapply(datos_num, var, na.rm = TRUE)  # Varianza
sapply(datos_num, sd, na.rm = TRUE)   # Desviación estándar
```

## Cálculo del rango intercuartílico para cada variable numérica relevante
```{r message=FALSE, warning=FALSE}
sapply(datos_num, IQR, na.rm = TRUE)
```

## **Relación entre el Nivel de Estrés y Puesto de Trabajo**
```{r message=FALSE, warning=FALSE}
ggplot(datos, aes(x = reorder(puesto, estres_bajo, FUN = median), y = estres_bajo)) +
  geom_bar(stat = "summary", fun = "median", fill = "orange", color = "black") +
  coord_flip() +  # Invertir ejes para tener los puestos en el eje y y las barras extendiéndose horizontalmente
  theme_minimal() +
  labs(title = "Nivel de Estrés Mediano por Puesto de Trabajo",
       y = "Nivel de Estrés Mediano",
       x = "Puesto") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

En esta gráfica de barras podemos observar diferentes puestos de trabajo y su correspondiente nivel mediano de estrés.
Los puestos con niveles más altos de estrés parecen ser soldador,otro, y operador.
Un hallazgo importante es que estos puestos pueden tener condiciones de trabajo que generan un alto nivel de estrés, lo que podría estar contribuyendo a la rotación de personal. La empresa FORM podría enfocarse en mejorar las condiciones de trabajo en estos puestos, tal vez automatizando tareas estresantes o proporcionando más apoyo y descansos.
Los puestos con menores niveles de estrés son asistente de producción,embarque, y mantenimiento, lo que podría indicar que estas áreas son menos propensas a experimentar rotación debido al estrés laboral.

## **Relación entre la Antigüedad y el Salario**

```{r message=FALSE, warning=FALSE}
antiguedad_por_salario <- datos %>%
  group_by(salario_bueno) %>%
  summarise(antiguedad_promedio = mean(antiguedad, na.rm = TRUE)) %>%
  arrange(desc(antiguedad_promedio))

# Definir una paleta de colores personalizada
colores_personalizados <- c('Totalmente de acuerdo' = '#AED6F1', # Claro
                            'Medianamente de acuerdo' = '#5DADE2', # Intermedio claro
                            'Ni de acuerdo ni en desacuerdo' = '#3498DB', # Neutro
                            'Medianamente en desacuerdo' = '#2874A6', # Intermedio oscuro
                            'Totalmente en desacuerdo' = '#1B4F72') # Oscuro

# Gráfico de barras de la antigüedad promedio por satisfacción con el salario, usando colores personalizados
ggplot(antiguedad_por_salario, aes(x = salario_bueno, y = antiguedad_promedio, fill = salario_bueno)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colores_personalizados) + # Usa la paleta de colores personalizada
  coord_flip() +
  theme_minimal() +
  labs(title = "Antigüedad Promedio por Satisfacción con el Salario",
       x = "Satisfacción con el Salario",
       y = "Antigüedad Promedio (años)"
```

En esta gráfica de barras verticales podemos ver la relación entre la antigüedad promedio en la empresa y la satisfacción que tiene con el salario.
Parece ser que existe una correlación entre la antigüedad y la satisfacción salarial, siendo aquellos que están totalmente de acuerdo con su salario quienes tienen una antigüedad promedio más alta (alrededor de 15 a 20 años).

Un hallazgo relevante es que la satisfacción salarial aumenta con la antigüedad. Esto podría indicar que los incrementos salariales o bonos basados en la antigüedad son efectivos, o que aquellos con mayor antigüedad están en puestos mejor remunerados debido a ascensos o aumentos basados en el desempeño a lo largo del tiempo.
La empresa FORM podría considerar ajustar su estructura salarial para mejorar la satisfacción entre los empleados más nuevos o aquellos con menos antigüedad, lo que potencialmente podría reducir la rotación de personal.

## **Percepción de Molestia por la Temperatura por Puesto**

```{r message=FALSE, warning=FALSE}
datos %>%
  group_by(puesto, no_molestia_temperatura) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = puesto, y = count, fill = no_molestia_temperatura)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percepción de Molestia por la Temperatura por Puesto",
       x = "Puesto",
       y = "Cantidad",
       fill = "No Molesta la Temperatura") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

vemsop una clara molestia con la temperatura de parte de los ayudantes generales, por lo que se tiene que hacer algo para regular la temperatura dentro del espacio donde se desenvuelven estos, pues no vemos una descontento tan grande dentro de las otras areas.

## **Disconformidad por Puesto** 

```{r message=FALSE, warning=FALSE}
datos %>% 
  group_by(puesto, permanencia_form_futuro) %>% 
  summarise(count = n()) %>%
  filter(permanencia_form_futuro != "Totalmente de acuerdo" & permanencia_form_futuro != "Medianamente de acuerdo") %>%
  ggplot(aes(x = reorder(puesto, -count), y = count, fill = permanencia_form_futuro)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Disconformidad por Puesto",
       x = "Puesto",
       y = "Cantidad de Disconformidad") +
  theme_minimal()
```


##  **Percepción del Estrés por Rangos de Antigüedad**

```{r message=FALSE, warning=FALSE}
datos$antiguedad_rango <- cut(datos$antiguedad, breaks = seq(0, max(datos$antiguedad, na.rm = TRUE) + 5, by = 5), right = FALSE, labels = paste(seq(0, max(datos$antiguedad, na.rm = TRUE), by = 5), seq(5, max(datos$antiguedad, na.rm = TRUE) + 5, by = 5) - 1, sep = "-"))
```

```{r message=FALSE, warning=FALSE}
datos %>%
  group_by(antiguedad_rango, estres_bajo) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = antiguedad_rango, y = count, fill = estres_bajo)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percepción del Estrés por Rangos de Antigüedad",
       x = "Rango de Antigüedad",
       y = "Cantidad",
       fill = "Percepción de Bajo Estrés") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Tenemos un buen indicar de que el estrés no es algo que esté afectando a los trabajadores, pues vemos que la mayoría, independientemente del rango de antiguedad con el que cuentan, considera tener un estrés bajo dentro de las actividades dentro de la empresa.

##  **Percepción de Prestaciones por Puesto**

```{r message=FALSE, warning=FALSE}
datos %>%
  group_by(puesto, prestaciones_bueno) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = puesto, y = count, fill = prestaciones_bueno)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percepción de Prestaciones por Puesto",
       x = "Puesto",
       y = "Cantidad",
       fill = "Hay Buenas Prestaciones") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Podemos observar que dentro de los ayudantes genrales es donde existe una mayor cantidad de datos, pues es de donde hay mas gente, existen opiniones divididas para de si hay buenas prestaciones o no para la empresa. Esto sin duda nos hace entender que no se encuentran conformes con la sprestaciones que les está brindando la empresa, ya que si fuera así, no se tendría este comportamiento de los datos.

Se puede concluir para esta base de datos que las principales áreas de mejora que podría tener la empresa con sus empleados son en la aprte de aydantes generales, que se encuentrán pircipalemnte inconformes con la temperatura y no creen tener buenas prestaciones. Esto puede estar haciendo que haya una rotación tan alta dentro de esta área de la empresa.

# **Bajas FORM**

```{r}
#file.choose()
```


```{r message=FALSE, warning=FALSE}
df= read_xlsx("C:\\Users\\Eduardo\\Downloads\\BDD_FORM_BAJAS_2023.xlsx")
head(df)
```

```{r message=FALSE, warning=FALSE}
summary(df)
```

```{r message=FALSE, warning=FALSE}
df <- df %>% 
  mutate(Dpto = if_else(Dpto == "Produccion Cartón MC", "Producción Cartón MC", Dpto))
```

## Bajas por Departamento

```{r message=FALSE, warning=FALSE}
bajas_por_departamento <- df %>%
  group_by(Dpto) %>%
  summarise(Total_Bajas = n())

ggplot(bajas_por_departamento, aes(x = reorder(Dpto, -Total_Bajas), y = Total_Bajas, fill = Dpto)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Bajas por Departamento", x = "Departamento", y = "Total de Bajas")
```

```{r message=FALSE, warning=FALSE} 
bajas_por_departamento <- df %>%
  group_by(Dpto) %>%
  summarise(Total_Bajas = n()) %>%
  filter(Total_Bajas > 1)

# Ordenamos las bajas por departamento de mayor a menor en el gráfico
ggplot(bajas_por_departamento, aes(x = reorder(Dpto, -Total_Bajas), y = Total_Bajas, fill = Dpto)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Bajas por Departamento (Filtrado)", x = "Departamento", y = "Total de Bajas")

```


## **Bajas por Departamento y Género**

```{r message=FALSE, warning=FALSE}
bajas_por_departamento_genero <- df %>%
  group_by(Dpto, Género) %>%
  summarise(Total_Bajas = n())

ggplot(bajas_por_departamento_genero, aes(x = reorder(Dpto, -Total_Bajas), y = Total_Bajas, fill = Género)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Bajas por Departamento y Género", x = "Departamento", y = "Total de Bajas")
```

```{r message=FALSE, warning=FALSE}
bajas_por_departamento_genero <- df %>%
  group_by(Dpto, Género) %>%
  summarise(Total_Bajas = n()) %>%
  filter(Total_Bajas > 1)

ggplot(bajas_por_departamento_genero, aes(x = reorder(Dpto, -Total_Bajas), y = Total_Bajas, fill = Género)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Bajas por Departamento y Género (Filtrado)", x = "Departamento", y = "Total de Bajas")

```

## **Bajas por Motivo y Género**

```{r message=FALSE, warning=FALSE}
bajas_por_motivo_genero <- df %>%
  group_by(`Motivo de Baja`, Género) %>%
  summarise(Total_Bajas = n())

ggplot(bajas_por_motivo_genero, aes(x = `Motivo de Baja`, y = Total_Bajas, fill = Género)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Bajas por Motivo y Género", x = "Motivo de Baja", y = "Total de Bajas") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Como podemos observar en estas gráficas, los dos departamentos donde vemos una mayor cantidad de bajas es en Producción de Cartón tanto MC como ML. Esto nos hace entender que ahí hay un problema grave y se tienen que tomar cartas en el asunto para detectarlo lo antes posible para generar alguna estrategia para abolirlo. De las 18 personas que fueron bajas de la empresa 17 fueron mujeres, algo que nos podría indicar un problema grave relacionado al tema de género.


```{r message=FALSE, warning=FALSE}
df$`Fecha de Baja` <- as.Date(df$`Fecha de Baja`, origin = "1899-12-30")

df$AñoMes <- format(df$`Fecha de Baja`, "%Y-%m")
```


## **Tendencia de Bajas a lo Largo del Tiempo**

```{r message=FALSE, warning=FALSE}
bajas_por_fecha <- df %>%
  group_by(AñoMes) %>%
  summarise(Total_Bajas = n())

ggplot(bajas_por_fecha, aes(x = AñoMes, y = Total_Bajas, group = 1)) +
  geom_line() +
  geom_point() +
  theme_minimal() +
  labs(title = "Tendencia de Bajas a lo Largo del Tiempo", x = "Año y Mes", y = "Total de Bajas") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## *Bajas Totales por Mes**

```{r message=FALSE, warning=FALSE}

df$`Fecha de Baja` <- as.Date(df$`Fecha de Baja`, origin = "1899-12-30")

bajas_por_mes <- df %>%
  mutate(Mes = format(`Fecha de Baja`, "%B")) %>%
  group_by(Mes) %>%
  summarise(Total_Bajas = n())

meses <- format(seq(as.Date("2000-01-01"), as.Date("2000-12-01"), by = "month"), "%B")
bajas_por_mes$Mes <- factor(bajas_por_mes$Mes, levels = meses)

# Ahora ordenamos los datos para el gráfico
bajas_por_mes <- bajas_por_mes %>%
  mutate(Mes = reorder(Mes, -Total_Bajas))

# Gráfico de barras mostrando las bajas totales por mes, ordenadas de mayor a menor
ggplot(bajas_por_mes, aes(x = Mes, y = Total_Bajas, fill = Mes)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Bajas Totales por Mes Ordenadas", x = "Mes", y = "Total de Bajas")

```

A falta datos de Marzo a Mayo, podemos inferir que no hubieron bajas en la empresa, sin embargo vemos un gran incremento en las bajas en el mes de junio, lo que hace mucho sentido. Esto que se observa puede ser por una razón legal en cuanto a temas de cotratos o puede tener cierta relación con un problema que pudo haber dentro de la parte de producción de cartón, pues la mayoría de estas bajas en el mes fueron de igual manera por esta razón. Se debe de realizar un análisis a mayor profundidad para entender de una mejor forma.


```{r}
bajas_por_estado_civil <- df %>%
  group_by(`Estado Civil`) %>%
  summarise(Total_Bajas = n()) %>%
  mutate(`Estado Civil` = reorder(`Estado Civil`, -Total_Bajas))

ggplot(bajas_por_estado_civil, aes(x = `Estado Civil`, y = Total_Bajas, fill = `Estado Civil`)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Bajas por Estado Civil", x = "Estado Civil", y = "Total de Bajas") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Se puede observar de una muy buena forma, que el estar soltero o soltera es la manera en la que las personas se dan más de baja. Esto puede ser derivado de que no tienen una familia o una persona que pueda llegar a depender de ellos.


## **Análisis de Sentimiento**

#Las 2 tendencias de las emociones son: Positiva o Negativa

```{r}
texto <- readtext("C:\\Users\\Eduardo\\Downloads\\cotizacion imss fecha pago comer 3pmcomodo contento.txt")
str(texto)
texto_sin_numeros <- gsub("\\d+", "", texto)
texto_palabras <- get_tokens(texto)
View(texto_palabras)
emociones_df <- get_nrc_sentiment(texto_palabras, language = "spanish")
```

```{r}
barplot(colSums(prop.table(emociones_df[, 1:8])))

sentimientos <- (emociones_df$negative*-1) + emociones_df$positive
simple_plot(sentimientos)
```

Este análisis de sentimiento general, nos muestra un sentimiento positivo dentro de la empresa. Esto se cree que es ya que se hizo con base en una pregunta abierta contestada por los colaboradores, en la cuál creemos ue es más complicado que realmente se expresen en 3 palabras de una manera negativa.


##Referencias 

#1. *D&B Hoovers is Your Sales Accelerator -- Dun & Bradstreet*. (s. f.). Recuperado 16 de marzo de 2024, de <https://www.dnb.com/products/dnb-hoovers.html> 

#2. *World Bank Group - International Development, Poverty, & Sustainability*. (s. f.). World Bank. Recuperado 16 de marzo de 2024, de <https://www.worldbank.org/en/home> 

#3. *Smithers - Innovate with confidence*. (s. f.). Smithers. Recuperado 16 de marzo de 2024, de <https://www.smithers.com/home> 

#4. *Statista. (s. f.). Statista - the statistics portal*. Recuperado 16 de marzo de 2024, de <https://www.statista.com/> 

#5. *MexicoIndustry. (s. f.). *Incrementará 8% el sector automotriz en 2024*. MexicoIndustry. Recuperado 16 de marzo de 2024, de <https://mexicoindustry.com/noticia/incrementara-8-el-sector-automotriz-en-2024> 

#6. *Newsroom Infobae. (2023, 12 abril). Industria automotriz en México espera más empleos por electromovilidad. *Infobae*. Recuperado 16 de marzo de 2024, de <https://www.infobae.com/america/agencias/2023/04/12/industria-automotriz-en-mexico-espera-mas-empleos-por-electromovilidad/>

